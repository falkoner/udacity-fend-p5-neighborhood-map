function initMap(){var e=new google.maps.LatLng(37.376773,-122.030157),i={center:e,scrollWheel:!1,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:18,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};map=new google.maps.Map(document.getElementById("map-canvas"),i),viewModel.isMapLoaded(!0),viewModel.renderMarkers()}function fetchDinersFromGooglePlaces(e){function i(e,i,t){var r=["geometry","name","place_id","price_level","rating","vicinity"];if(i==google.maps.places.PlacesServiceStatus.OK)for(var a=0;a<e.length;a++){var s=e[a];o.push(n(s,r))}t.hasNextPage?(console.log("There is more!"),setTimeout(function(){t.nextPage()},2e3)):console.log(JSON.stringify(o))}function n(e,i){var n={};return i.forEach(function(i){n[i]=e[i]}),n}var o=[],t={location:e,radius:"300",types:["restaurant","cafe","bar"]};service=new google.maps.places.PlacesService(map),service.nearbySearch(t,i)}var map,Diner=function(e){var i=this,n="img/icon_24.png";i.name=ko.observable(e.name),i.coordinates=e.geometry.location,i.id=ko.observable(e.place_id),i.price_level=e.price_level,i.rating=e.rating,i.vicinity=e.vicinity,i.visitCounter=ko.observable("");var o;i.setMarker=function(){o=new google.maps.Marker({position:i.coordinates,title:i.name(),url:"#",icon:n,animation:google.maps.Animation.DROP}),o.setMap(map),o.addListener("click",function(){viewModel.selectDiner(i)})},i.toggleDinerInfo=function(){null!==o.getAnimation()?o.setAnimation(null):o.setAnimation(google.maps.Animation.BOUNCE)}},DinersViewModel=function(){var e=this;e.selectedDiner=ko.observable(),e.isMapLoaded=ko.observable(!1),e.listOfDiners=ko.observableArray([]),e.selectDiner=function(i){e.selectedDiner()&&e.selectNoDiner(),e.selectedDiner(i),i.toggleDinerInfo()},e.selectNoDiner=function(){e.selectedDiner().toggleDinerInfo(),e.selectedDiner(null)},e.visitDiner=function(e){var i=e.visitCounter();""===i&&(i=0),e.visitCounter(i+1)},e.visitProgress=ko.computed(function(){var i=0,n=0;return e.listOfDiners().forEach(function(e){e.visitCounter()>0&&i++}),n=e.listOfDiners().length,i+" out of "+n},this),e.renderMarkers=function(){e.listOfDiners().forEach(function(e){e.setMarker()})},e.loadStoredData=function(){$.getJSON("/js/seeddata.json").done(function(i){e.listOfDiners([]),i.forEach(function(i){e.listOfDiners.push(new Diner(i))})})},e.loadStoredData()},viewModel=new DinersViewModel;ko.applyBindings(viewModel);