function initMap(){var e=new google.maps.LatLng(37.376773,-122.030157),n={center:e,scrollWheel:!1,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:18,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};map=new google.maps.Map(document.getElementById("map-canvas"),n),infoWindow=new google.maps.InfoWindow({content:'<div id="infowindow-container" data-bind="template: { name: \'diner-infowindow-template\', data: selectedDiner }"></div>'});var i=!1;google.maps.event.addListener(infoWindow,"domready",function(){i||(ko.applyBindings(viewModel,$("#infowindow-container")[0]),i=!0)}),viewModel.isMapLoaded(!0),viewModel.renderMarkers()}function fetchDinersFromGooglePlaces(e){function n(e,n,t){var a=["geometry","name","place_id","price_level","rating","vicinity"];if(n==google.maps.places.PlacesServiceStatus.OK)for(var r=0;r<e.length;r++){var s=e[r];o.push(i(s,a))}t.hasNextPage?(console.log("There is more!"),setTimeout(function(){t.nextPage()},2e3)):console.log(JSON.stringify(o))}function i(e,n){var i={};return n.forEach(function(n){i[n]=e[n]}),i}var o=[],t={location:e,radius:"300",types:["restaurant","cafe","bar"]};service=new google.maps.places.PlacesService(map),service.nearbySearch(t,n)}var map,infoWindow,Diner=function(e){var n=this,i="img/icon_24.png";n.name=ko.observable(e.name),n.coordinates=e.geometry.location,n.id=ko.observable(e.place_id),n.price_level=e.price_level,n.rating=e.rating,n.vicinity=e.vicinity,n.visitCounter=ko.observable("");var o;n.setMarker=function(){o=new google.maps.Marker({position:n.coordinates,title:n.name(),url:"#",icon:i,animation:google.maps.Animation.DROP}),o.setMap(map),o.addListener("click",function(){viewModel.selectDiner(n)})},n.select=function(){infoWindow.open(map,o),o.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){o.setAnimation(null)},5e3)},n.deselect=function(){infoWindow.close(),o.setAnimation(null)}},DinersViewModel=function(){var e=this;e.selectedDiner=ko.observable(),e.isMapLoaded=ko.observable(!1),e.listOfDiners=ko.observableArray([]),e.selectDiner=function(n){e.selectNoDiner(),n.select(),e.selectedDiner(n)},e.selectNoDiner=function(){e.selectedDiner()&&e.selectedDiner().deselect()},e.visitDiner=function(e){var n=e.visitCounter();""===n&&(n=0),e.visitCounter(n+1)},e.visitProgress=ko.computed(function(){var n=0,i=0;return e.listOfDiners().forEach(function(e){e.visitCounter()>0&&n++}),i=e.listOfDiners().length,n+" out of "+i},this),e.renderMarkers=function(){e.listOfDiners().forEach(function(e){e.setMarker()})},e.loadStoredData=function(){$.getJSON("/js/seeddata.json").done(function(n){e.listOfDiners([]),n.forEach(function(n){e.listOfDiners.push(new Diner(n))})})},e.loadStoredData()},viewModel=new DinersViewModel;ko.applyBindings(viewModel);